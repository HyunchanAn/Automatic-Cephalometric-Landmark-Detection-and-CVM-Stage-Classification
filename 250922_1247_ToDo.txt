A. 지금 당장 CPU에서 해야 할 것 (우선순위 높음)

1. CVM 라벨/손실 정합 수정
: dataset.py:get_cvm_stage()가 원-핫을 반환한다 → 정수 인덱스(0~5) 로 바꿔라. 그러면 CrossEntropyLoss와 일치한다
: 검증에서도 argmax 비교 대신 정수 라벨과 바로 비교.

2. 랜드마크 타깃 편향 제거
: Senior/Junior 평균 계산 시 np.ceil 제거하고 산술평균만 쓰라. 1px 내외의 체계적 편향을 없앤다

3. 증강 경량화(좌표 보존 중심)
: 현재 Affine/밝기/노이즈는 유지하되 범위 축소(예: 회전 ±10°, 스케일 0.95~1.05, 평행이동 ±3%).
: ElasticTransform는 비활성 유지(좌표 왜곡 리스크)

4. 데이터로더/CPU 최적화
: DataLoader(num_workers>0, persistent_workers=True) 적용. CPU 로딩 병목 완화.
: CPU 학습이므로 pin_memory는 의미 없음(꺼도 됨). <- 그치만 현재 컴퓨터는 GPU 가속이 안 되는 특수 환경이고, 집에서는 가능하므로 끄지 말 것.
: OpenBLAS/MKL 스레드 수를 시스템 여건에 맞게 조정(torch.set_num_threads, 환경변수)하여 BLAS 병렬화 활용.

5. 훈련 안정화
: ReduceLROnPlateau는 유지하되 모니터링 지표를 MRE로 고정(이미 코드상 그렇게 사용 중)
: Early Stopping 기준을 추가(MRE 개선 정체 시 중단) → CPU 시간 절감.

6. 손실 밸런스 재탐색(가벼운 스윕)
: CVM이 제대로 학습되기 시작하면 CVM_LOSS_WEIGHT=10.0은 과할 수 있다. 1, 2, 5 정도만 빠르게 탐색

7. 로깅 정규화
: 에폭별 Avg Train/Valid Loss, MRE, CVM F1을 CSV로 적재(추후 그래프 자동화).
: 현재 로그에는 “cpu로 초기화”가 명시된다. CPU 유지 전제로 추세만 본다

B. CPU에서 검증 가능한 실험(소공수, 빠른 피드백)

8. 해상도·배치/누적그래드 실험
: 입력 256 유지(속도/정확도 균형)
: GPU 없는 환경에서는 배치 작게 + Gradient Accumulation으로 유효 배치를 확보.

9. 백본 동결 전략 재점검
: AdvancedCephNet는 백본 Freeze 상태에서 헤드만 학습한다. CPU에서는 이 전략이 수렴속도/안정성에 유리.
: 아주 후반(예: 10~20 epoch 후) 상위 블록만 선택적 unfreeze하고 학습률 1/10로 미세 조정(소에폭로 영향만 확인).

10. CVM 전용 간단 베이스라인
: 멀티태스킹에서 분류가 묻히는지 확인하기 위해, 이미지 다운샘플(예: 224) + 얕은 분류기(작은 CNN/Linear head)로 단독 학습 A/B.
: F1이 단독 태스크에서 즉시 상승하면, 멀티태스킹 손실 밸런스 문제가 맞다.

C. GPU 필요 작업 — 대기열(설계/코드 준비만 CPU에서 진행)

11. 히트맵 기반 랜드마크로 전환(핵심) << 이건 다음에 브랜치 새로 내서 할꺼니까 참고만 해둬라
: 29채널 가우시안 히트맵 타깃 + MSE, soft-argmax/DARK 복원.
: 입력 512로 올리면 MRE 3px 영역 현실권. CPU에선 파이프라인만 구현해두고, 본 학습은 GPU에서.

12. CVM ROI 파이프라인
: C2–C4 ROI 검출(간단 탐지/세그) → ROI 전용 분류기(EfficientNet 계열 소형).
: 클래스 불균형 대응(Class-weighted CE/Focal, Stratified sampler).
: CPU에선 데이터 준비·증강 정의·코드 스캐폴드까지만.

D. 운영·품질 관리

13. 평가 스크립트 일원화
: evaluate.py로 테스트셋 평가/특정 인덱스 시각화 통합(메모 기준 이미 합쳐둔 방향)
: 평가 시 픽셀→mm 변환 경로가 있으면 함께 산출(임상 의미 확보).

14. 체크포인트/베스트 모델 정책
: best_model.pth는 MRE 최저 기준 유지
: I/O 절약 위해 전체 에폭 저장 간격(예: 5에폭 간격)로 조정.

*** 왜 이 순서인가

: 현재 로그는 CPU에서 정상 수렴 중이나, 핵심 병목은 설계/라벨 정합에 있다. CVM 원-핫×CE 불일치를 즉시 수정하고, 랜드마크 타깃 올림 제거만으로도 지표가 바로 반응한다
: CPU에서는 작은 변경으로 수렴 품질/속도 개선을 노리고, 대규모 성능 점프(히트맵·ROI) 는 GPU 대기열로 분리하는 것이 합리적이다.